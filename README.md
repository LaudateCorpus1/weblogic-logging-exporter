# WebLogic Logging Exporter

The WebLogic Logging Exporter (the "logging exporter") adds a log event handler to WebLogic Server,
such that WLS server logs can be integrated into [Elastic Stack](https://www.elastic.co/products)
in Kubernetes directly,  by using the [Elasticsearch](https://www.elastic.co/products/elasticsearch) REST API.

The goal of this project is to provide an easy to configure, robust, and production-ready solution to access
WLS log information through Elasticsearch and Kibana.

## Getting Started

These instructions outline the steps to build the `weblogic-logging-exporter.jar` file, which can then be integrated into the [WebLogic Kubernetes Operator](https://github.com/oracle/weblogic-kubernetes-operator/) for handling the server logs generated by the WebLogic Server domain.

## Download the release

You can download the WebLogic Logging Exporter already compiled for you from the [releases page]().

## Building from source

If you prefer, you can build the WebLogic Logging Exporter from the source code.  To do this, you will
need access to some WebLogic Server libraries.  There are two ways to get these libraries:

* Populate you local Maven repository with the required files from a local WebLogic Server installation
  using the Oracle Maven Synchronization plugin, or
* Use the Oracle Maven repository to download them as part of your build, this requires registration and
  configuring your local Maven installation with the appropriate authentication details.

### Populating your local Maven repository from a local WebLogic Server installation

You can use the Oracle Maven Synchronization plugin, which is included in your WebLogic Server installation,
to install the necessary dependencies into your local Maven repository.

There are two steps:

* Install the Oracle Maven Synchronization plugin,
* Run the "push" goal to populate your local Maven repository from your WebLogic Server installation.

#### Installing the Oracle Maven Synchronization plugin

To install the plugin, navigate to your WebLogic Server installation then enter the commands (this example
assumes you installed WebLogic Server in /u01/wlshome):

```
cd /u01/wlshome/oracle_common/plugins/maven/com/oracle/12.2.1/oracle-maven-sync
mvn install:install-file -DpomFile=oracle-maven-sync-12.2.1.pom -Dfile=oracle-maven-sync-12.2.1.jar
```

#### Popoulating your local Maven repository

To populate your local Maven repository from your WebLogic Server installation, enter this command:

```
mvn com.oracle.maven:oracle-maven-sync:push -DoracleHome=/u01/wlshome
```

You can verify the dependencies were installed by looking in your local Maven repository which is
normally located at `~/.m2/repository/com/oracle/weblogic`.


### Using the Oracle Maven repository

Note: If you populated your local repository using the Oracle Maven Synchronization plugin, then this
step is *not* required.

To access the Oracle Maven repository, there are two requirements to be aware of:

1. You must be using [Maven 3.2.5](http://maven.apache.org/docs/3.2.5/release-notes.html) or later.
This contains the version of the [Wagon 2.8](http://maven.apache.org/wagon/) component that has
been enhanced to support access to artifacts that are protected by
[HTTP authentication schemes](https://issues.apache.org/jira/projects/WAGON/issues/WAGON-422).

2. You must be registered with OTN and have accepted the license agreement to access and use the
Oracle Maven Repository.  This can be done with either a new or an existing OTN user account by
accessing the http://maven.oracle.com site and selecting the registration link.
After registering, then you just need to configure your local Maven environment with the details
of the Oracle Maven Repository, including the information that relates to the authentication model
specifying your OTN user name and password.

#### Configure Maven

#### 1. Encrypt your OTN Password.

You need to configure Maven to use the Oracle Maven Repository. This involves telling Maven about the repository and providing the necessary information to authenticate to the repository.
The following steps show you how to save your OTN password in your `settings.xml` file so  that you do not have to specify it manually every time.
Oracle recommends that you encrypt your password, using the utilities provided with Maven.

Here are the steps to encrypt your password and save it in your settings.   For more information, refer to [Maven Password Encryption](http://maven.apache.org/guides/mini/guide-encryption.html).

```
mvn --encrypt-master-password my_master_password

```
The output will be a string similar to this:  

`{abcdefghijklmnopqrstuvwxyz123=}`

Save this value in your Maven `settings-security.xml` file.

A copy of your `~/.m2/settings-security.xml` file will look like this:
```
<settingsSecurity>
  <master>{abcdefghijklmnopqrstuvwxyz123=}</master>
</settingsSecurity>
```

Now that you have a master password defined, you can encrypt your OTN password using the following command:
```
mvn --encrypt-password my_OTN_password
```
The output will be another string that looks like this:  

`{==thisIs12My34_OTN_45_encrypted==}`

This will be the password that you provide in the `server` section of your `settings.xml` file when you configure the HTTP Wagon.  

#### 2. Add the Oracle Maven Repository to your `settings.xml` file.

Add a repository definition to your Maven `settings.xml` file. The repository definition should look like the following:

```
<profiles>
    <profile>
      <id>main</id>
      <activation>
        <activeByDefault>true</activeByDefault>
      </activation>
      <repositories>
        <repository>
          <id>maven.oracle.com</id>
          <url>https://maven.oracle.com</url>
          <layout>default</layout>
          <releases>
             <enabled>true</enabled>
          </releases>
        </repository>
      </repositories>

      <pluginRepositories>
        <pluginRepository>
          <id>maven.oracle.com</id>
          <url>https://maven.oracle.com</url>
        </pluginRepository>
      </pluginRepositories>
    </profile>
  </profiles>
```

The Maven `settings.xml` file requires additional settings to support the Oracle Maven Repository.
To configure the HTTP Wagon, add the following `<server>` element to the `<servers>` section of the Maven `settings.xml` file.
```
<servers>
    <server>
      <username>my_OTN_user_name</username>
      <password>{==thisIs12My34_OTN_45_encrypted==}</password>
      <configuration>
        <basicAuthScope>
          <host>ANY</host>
          <port>ANY</port>
          <realm>OAM 11g</realm>
        </basicAuthScope>
        <httpConfiguration>
          <all>
            <params>
              <property>
                <name>http.protocol.allow-circular-redirects</name>
                <value>%b,true</value>
              </property>
            </params>
          </all>
        </httpConfiguration>
      </configuration>
      <id>maven.oracle.com</id>
    </server>
  </servers>
```

If needed, specify the `proxies` that are required.

### Building the WebLogic Logging Exporter

To build the WebLogic Logging Exporter, simply clone the project from GitHub and then build it
with Maven:

```
git clone git@orahub.oraclecorp.com:oracle/wls-logging-exporter.git
mvn install
```

The `weblogic-logging-exporter-0.1-SNAPSHOT.jar` will be available under the `target` directory.

## Deployment

TBD.  Update how to integrate this JAR into WebLogic Kubernetes operator.

## Contributing

Please read [CONTRIBUTING.md](https://gist.github.com/PurpleBooth/b24679402957c63ec426) for details on our code of conduct, and the process for submitting pull requests to us.


## License

This project is licensed under the [_Universal Permissive License, Version 1.0_](http://oss.oracle.com/licenses/upl)
