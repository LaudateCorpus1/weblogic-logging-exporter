# WebLogic Logging Exporter

The WebLogic Logging Exporter (the "logging exporter") adds a log event handler to WebLogic Server, such that WLS server logs can be integrated into [Elastic Stack](https://www.elastic.co/products) in Kubernetes directly,  by using the [Elasticsearch](https://www.elastic.co/products/elasticsearch) REST API.  

The blog, [Let WebLogic work with Elastic Stack in Kubernetes](https://blogs.oracle.com/weblogicserver/let-weblogic-work-with-elk-in-kubernetes), outlines the steps to harvest WLS server logs using Logstash so that they can be filtered, manipulated, and viewed using Elasticsearch and Kibana.
However, that approach requires the setup of a shared volume which is outside of the pod, and the logs needs to be written to an intermediate log file for harvesting and parsing.

The goal of this project is to provide an easy to configure, robust, and production-ready solution to access WLS log information through Elasticsearch and Kibana.

## Getting Started

These instructions outline the steps to build the `weblogic-logging-exporter.jar` file, which can then be integrated into the [WebLogic Kubernetes Operator](https://github.com/oracle/weblogic-kubernetes-operator/) for handling the server logs generated by the WebLogic Server domain.

## Prerequisites

The logging exporter depends on the WebLogic logging JAR which is available from the [ Oracle Maven Repository](http://maven.oracle.com/).

To access the Oracle Maven Repository, there are two fundamental requirements to be aware of:

1. You must be using [Maven 3.2.5](http://maven.apache.org/docs/3.2.5/release-notes.html) or later.  This contains the version of the [Wagon 2.8](http://maven.apache.org/wagon/) component that has been enhanced to support access to artifacts that are protected by [HTTP authentication schemes](https://issues.apache.org/jira/projects/WAGON/issues/WAGON-422).

2. You must be registered with OTN and have accepted the license agreement to access and use the Oracle Maven Repository.  This can be done with either a new or an existing OTN user account by accessing the http://maven.oracle.com site and selecting the registration link.  
After registering, then you just need to configure your local Maven environment with the details of the Oracle Maven Repository, including the information that relates to the authentication model specifying your OTN user name and password.

## Building
### Configure Maven

#### 1. Encrypt your OTN Password.

You need to configure Maven to use the Oracle Maven Repository. This involves telling Maven about the repository and providing the necessary information to authenticate to the repository.
The following steps show you how to save your OTN password in your `settings.xml` file so  that you do not have to specify it manually every time.
Oracle recommends that you encrypt your password, using the utilities provided with Maven.

Here are the steps to encrypt your password and save it in your settings.   For more information, refer to [Maven Password Encryption](http://maven.apache.org/guides/mini/guide-encryption.html).

```
mvn --encrypt-master-password my_master_password

```
The output will be a string similar to this:  

`{abcdefghijklmnopqrstuvwxyz123=}`

Save this value in your Maven `settings-security.xml` file.

A copy of your `~/.m2/settings-security.xml` file will look like this:
```
<settingsSecurity>
  <master>{abcdefghijklmnopqrstuvwxyz123=}</master>
</settingsSecurity>
```

Now that you have a master password defined, you can encrypt your OTN password using the following command:
```
mvn --encrypt-password my_OTN_password
```
The output will be another string that looks like this:  

`{==thisIs12My34_OTN_45_encrypted==}`

This will be the password that you provide in the `server` section of your `settings.xml` file when you configure the HTTP Wagon.  

#### 2. Add the Oracle Maven Repository to your `settings.xml` file.

Add a repository definition to your Maven `settings.xml` file. The repository definition should look like the following:

```
<profiles>
    <profile>
      <id>main</id>
      <activation>
        <activeByDefault>true</activeByDefault>
      </activation>
      <repositories>
        <repository>
          <id>maven.oracle.com</id>
          <url>https://maven.oracle.com</url>
          <layout>default</layout>
          <releases>
             <enabled>true</enabled>
          </releases>
        </repository>
      </repositories>

      <pluginRepositories>
        <pluginRepository>
          <id>maven.oracle.com</id>
          <url>https://maven.oracle.com</url>
        </pluginRepository>
      </pluginRepositories>
    </profile>
  </profiles>
```

The Maven `settings.xml` file requires additional settings to support the Oracle Maven Repository.
To configure the HTTP Wagon, add the following `<server>` element to the `<servers>` section of the Maven `settings.xml` file.
```
<servers>
    <server>
      <username>my_OTN_user_name</username>
      <password>{==thisIs12My34_OTN_45_encrypted==}</password>
      <configuration>
        <basicAuthScope>
          <host>ANY</host>
          <port>ANY</port>
          <realm>OAM 11g</realm>
        </basicAuthScope>
        <httpConfiguration>
          <all>
            <params>
              <property>
                <name>http.protocol.allow-circular-redirects</name>
                <value>%b,true</value>
              </property>
            </params>
          </all>
        </httpConfiguration>
      </configuration>
      <id>maven.oracle.com</id>
    </server>
  </servers>
```

If needed, specify the `proxies` that are required.

#### 3. Clone the project and build it.
```
git clone git@orahub.oraclecorp.com:oracle/wls-logging-exporter.git
mvn install
```

The `weblogic-logging-exporter-1.0-SNAPSHOT.jar` will be available under the `target` directory.

## Deployment

TBD.  Update how to integrate this JAR into WebLogic Kubernetes operator.

## Contributing

Please read [CONTRIBUTING.md](https://gist.github.com/PurpleBooth/b24679402957c63ec426) for details on our code of conduct, and the process for submitting pull requests to us.


## License

This project is licensed under the [_Universal Permissive License, Version 1.0_](http://oss.oracle.com/licenses/upl)
